---
title: Qt 信号和槽
date: 2022-08-25 18:15:39
categories: [Qt]
tags: [Qt]
---
## 信号和槽
当我们需要一个界面通知另一个界面时，可以采用信号和槽机制。通过链接信号和槽，当一个界面发送信号时，链接该信号的槽会被响应，从而达到消息传递的目的。
所以我们先创建一个Qapplication Widgets 应用。Creator会为我们生成mainwindow类和其界面。我们在界面添加一个按钮，按钮的名字叫showChildButton, 按钮显示的文字改为“显示子界面”。
同时为该界面添加一个label，显示的文字修改为“这是主界面”
<!--more-->
![https://cdn.llfc.club/EBD5635CE2FA.png](https://cdn.llfc.club/EBD5635CE2FA.png)
现在实现点击按钮，在控制台打印一条日志  "show child dialog "
我们先在MainWindow的构造函数中添加信号和槽的链接逻辑
``` cpp
connect(ui->showChildButton, SIGNAL(clicked(bool)), this, SLOT(showChildDialog()));
```
然后我们为MainWindow添加showChildDialog槽函数，槽函数需要用slots声明，我们这里在mainwindow.h里用public slots的方式声明槽函数。
``` cpp
public slots:
    void showChildDialog();
```
接下来去mainwindow.cpp中完成该函数的实现，可以在头文件中右键该函数，在弹出菜单里选择Refactor, 再选择在mainwindow.cpp中添加实现。
![https://cdn.llfc.club/645C3ED1042D.png](https://cdn.llfc.club/645C3ED1042D.png)
也可以将鼠标光标放置在这个函数上，按alt+enter，弹出菜单选择在mainwindow.cpp中添加实现。这两种方式都是快捷添加，也可以直接去mainwindow.cpp里实现。
``` cpp
void MainWindow::showChildDialog()
{
    qDebug() << "show child dialog " << endl;
}
```
运行项目后点击按钮，就可以看到控制台弹出show child dialog日志。

## 不同的连接方式

我们上边用来连接信号和槽的方式是qt4提供的方式，用SIGNAL和SLOT将信号和槽转化为字符串。
但是这种方式会存在一定问题，Qt要求槽函数的参数不能超过信号定义的参数，比如我们用到的信号clicked(bool)参数就是bool，我们定义的槽函数showChildDialog()是不带参数的，可以连接成功，如果我们在连接的时候将showChildDialog的参数写为3个，也可以连接成功
``` cpp
 //qt4 风格的Slot和Signal 只是宏转换，字符串定义不能检测编译错误
 connect(ui->showChildButton, SIGNAL(clicked(bool)), this, SLOT(showChildDialog(1,2,3)));
```
但是点击会没有反应，说明qt4 这种连接信号和槽的方式不做编译检查，只是将信号和槽函数转译成字符串。
所以我推荐使用qt5以上版本的连接方式
``` cpp
 //推荐qt5 风格
connect(ui->showChildButton, &QPushButton::clicked, this, &MainWindow::showChildDialog);
```
这种方式也可以实现信号和槽函数的连接。

## 实现界面的切换
我们现在实现这样一个demo，程序启动后弹出主界面，点击主界面的按钮弹出子窗口，隐藏主界面，点击子窗口的按钮，隐藏子界面，显示主窗口。
所以我们右击项目弹出菜单选择创建Qt设计师界面类，选择Dialog without Buttons,

![https://cdn.llfc.club/1661563857494.jpg](https://cdn.llfc.club/1661563857494.jpg)

名字选择ChildDialog

![https://cdn.llfc.club/1661563857494.jpg](https://cdn.llfc.club/1661563857494.jpg)